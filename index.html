<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OPERATION EPIC FURY â€” LIVE TRACKER</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"/>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Oswald:wght@400;600;700&family=Barlow+Condensed:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<style>
  :root {
    --red:    #ff2222;
    --amber:  #ffb300;
    --green:  #39ff14;
    --cyan:   #00e5ff;
    --blue:   #2979ff;
    --purple: #d500f9;
    --bg:     #050a0f;
    --panel:  rgba(5,15,25,0.92);
    --border: rgba(0,229,255,0.18);
    --text:   #c8dce8;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    font-family: 'Barlow Condensed', sans-serif;
    color: var(--text);
    height: 100vh; width: 100vw;
    overflow: hidden;
    display: grid;
    grid-template-columns: 310px 1fr;
    grid-template-rows: 58px 1fr 44px;
  }

  /* â”€â”€â”€ HEADER â”€â”€â”€ */
  header {
    grid-column: 1 / -1;
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 20px;
    background: linear-gradient(90deg,#0a1520 0%,#07111c 60%,#0a1520 100%);
    border-bottom: 1px solid var(--border);
    position: relative; overflow: hidden;
  }
  header::after {
    content:''; position:absolute; left:0; bottom:0; width:100%; height:1px;
    background: linear-gradient(90deg, transparent, var(--red), var(--amber), var(--red), transparent);
    animation: scanline 3s linear infinite;
  }
  @keyframes scanline { 0%{transform:scaleX(0) translateX(-100%)} 100%{transform:scaleX(1) translateX(100%)} }

  .header-left { display:flex; align-items:center; gap:14px; }
  .op-badge {
    background: var(--red); color:#fff; font-family:'Share Tech Mono',monospace;
    font-size:10px; font-weight:700; padding:3px 8px; letter-spacing:2px;
    text-transform:uppercase; border:1px solid rgba(255,34,34,0.5);
    animation: badgePulse 1.8s ease-in-out infinite;
  }
  @keyframes badgePulse {
    0%,100%{box-shadow:0 0 6px var(--red)} 50%{box-shadow:0 0 18px var(--red), 0 0 30px rgba(255,34,34,0.3)}
  }
  .header-title {
    font-family:'Oswald',sans-serif; font-size:22px; font-weight:700;
    letter-spacing:3px; text-transform:uppercase; color:#fff;
    text-shadow: 0 0 20px rgba(255,34,34,0.6);
  }
  .header-title span { color: var(--red); }
  .header-sub {
    font-family:'Share Tech Mono',monospace; font-size:11px; color:#7a9bb5;
    letter-spacing:1.5px; margin-top:1px;
  }
  .header-right { display:flex; align-items:center; gap:20px; text-align:right; }
  .stat-box { text-align:center; }
  .stat-val { font-family:'Share Tech Mono',monospace; font-size:20px; font-weight:700; line-height:1; }
  .stat-lbl { font-size:10px; letter-spacing:1.5px; color:#5a7a8a; text-transform:uppercase; margin-top:2px; }
  .stat-val.red { color:var(--red); text-shadow:0 0 10px var(--red); }
  .stat-val.amber { color:var(--amber); text-shadow:0 0 10px var(--amber); }
  .stat-val.cyan { color:var(--cyan); }
  .vdiv { width:1px; height:36px; background:var(--border); }
  .live-dot {
    width:9px; height:9px; border-radius:50%; background:var(--red);
    display:inline-block; margin-right:6px;
    box-shadow:0 0 8px var(--red);
    animation: liveBlink 1s ease-in-out infinite;
  }
  @keyframes liveBlink { 0%,100%{opacity:1} 50%{opacity:.3} }
  .live-label { font-family:'Share Tech Mono',monospace; font-size:11px; color:var(--red); letter-spacing:2px; }

  /* â”€â”€â”€ SIDEBAR â”€â”€â”€ */
  aside {
    grid-row: 2; grid-column: 1;
    background: var(--panel);
    border-right: 1px solid var(--border);
    overflow-y: auto; padding: 0;
    display: flex; flex-direction: column;
  }
  aside::-webkit-scrollbar { width:4px; }
  aside::-webkit-scrollbar-track { background: transparent; }
  aside::-webkit-scrollbar-thumb { background: var(--border); border-radius:2px; }

  .section-head {
    padding: 8px 14px; font-family:'Share Tech Mono',monospace;
    font-size:10px; letter-spacing:2px; text-transform:uppercase;
    border-bottom: 1px solid var(--border);
    display: flex; align-items:center; gap:8px;
  }
  .section-head.attacked { background:rgba(255,34,34,0.08); color:var(--red); border-color:rgba(255,34,34,0.25); }
  .section-head.alert    { background:rgba(255,179,0,0.07); color:var(--amber); border-color:rgba(255,179,0,0.2); }
  .section-head.offense  { background:rgba(41,121,255,0.07); color:var(--blue); border-color:rgba(41,121,255,0.2); }
  .section-head.isr      { background:rgba(57,255,20,0.06); color:var(--green); border-color:rgba(57,255,20,0.2); }
  .section-head.iran     { background:rgba(213,0,249,0.07); color:var(--purple); border-color:rgba(213,0,249,0.2); }
  .section-head.naval    { background:rgba(0,229,255,0.07); color:var(--cyan); border-color:rgba(0,229,255,0.2); }
  .section-head.intel    { background:rgba(57,255,20,0.06); color:var(--green); border-color:rgba(57,255,20,0.2); }
  .dot { width:8px; height:8px; border-radius:50%; flex-shrink:0; }
  .dot.red { background:var(--red); box-shadow:0 0 6px var(--red); }
  .dot.amber { background:var(--amber); box-shadow:0 0 6px var(--amber); }
  .dot.blue { background:var(--blue); box-shadow:0 0 6px var(--blue); }
  .dot.green { background:var(--green); box-shadow:0 0 6px var(--green); }
  .dot.purple { background:var(--purple); box-shadow:0 0 6px var(--purple); }
  .dot.cyan { background:var(--cyan); box-shadow:0 0 6px var(--cyan); }

  .base-list { padding: 4px 0; }
  .base-item {
    display: flex; align-items: flex-start; gap: 10px;
    padding: 7px 14px; border-bottom: 1px solid rgba(255,255,255,0.04);
    cursor: pointer; transition: background 0.15s;
  }
  .base-item:hover { background: rgba(255,255,255,0.04); }
  .base-icon { font-size:14px; margin-top:1px; flex-shrink:0; }
  .base-name { font-family:'Barlow Condensed',sans-serif; font-size:13px; font-weight:600; color:#ddeeff; line-height:1.2; }
  .base-detail { font-family:'Share Tech Mono',monospace; font-size:9px; color:#4a6a7a; margin-top:2px; letter-spacing:.5px; line-height:1.4; }
  .base-status {
    margin-left:auto; flex-shrink:0;
    font-family:'Share Tech Mono',monospace; font-size:9px;
    padding:2px 6px; letter-spacing:1px; text-transform:uppercase;
    border-radius:2px; align-self:flex-start; margin-top:1px;
  }
  .status-hit    { background:rgba(255,34,34,0.15); color:var(--red); border:1px solid rgba(255,34,34,0.3); }
  .status-alert  { background:rgba(255,179,0,0.12); color:var(--amber); border:1px solid rgba(255,179,0,0.25); }
  .status-active { background:rgba(41,121,255,0.12); color:var(--blue); border:1px solid rgba(41,121,255,0.25); }
  .status-struck { background:rgba(213,0,249,0.12); color:var(--purple); border:1px solid rgba(213,0,249,0.25); }
  .status-patrol { background:rgba(0,229,255,0.10); color:var(--cyan); border:1px solid rgba(0,229,255,0.2); }

  /* â”€â”€â”€ MAP â”€â”€â”€ */
  #map {
    grid-row: 2; grid-column: 2;
    position: relative;
  }
  .leaflet-container { background: #07111c; }

  /* â”€â”€â”€ FOOTER â”€â”€â”€ */
  footer {
    grid-column: 1 / -1;
    display: flex; align-items:center; justify-content:space-between;
    padding: 0 20px;
    background: linear-gradient(90deg,#07111c,#050a0f,#07111c);
    border-top: 1px solid var(--border);
    font-family:'Share Tech Mono',monospace; font-size:9px; color:#3a5a6a;
    letter-spacing:1.2px;
  }
  .footer-sources { display:flex; gap:16px; }
  .footer-scroll {
    overflow:hidden; white-space:nowrap; flex:1; text-align:center;
    position:relative;
  }
  .ticker-wrap {
    display:inline-block; animation: ticker 45s linear infinite;
    color: #5a7a8a;
  }
  @keyframes ticker { 0%{transform:translateX(120%)} 100%{transform:translateX(-100%)} }

  /* â”€â”€â”€ LEAFLET CUSTOM â”€â”€â”€ */
  .leaflet-tile { filter: brightness(0.55) saturate(0.4) hue-rotate(175deg); }

  .leaflet-popup-content-wrapper {
    background: rgba(5,15,28,0.97) !important;
    border: 1px solid var(--border) !important;
    color: var(--text) !important;
    border-radius: 2px !important;
    font-family: 'Barlow Condensed', sans-serif !important;
    box-shadow: 0 0 20px rgba(0,0,0,0.8) !important;
    max-width: 260px;
  }
  .leaflet-popup-tip { background: rgba(5,15,28,0.97) !important; }
  .leaflet-popup-content { margin: 12px 14px !important; }
  .pop-title { font-size:14px; font-weight:700; color:#fff; letter-spacing:1px; margin-bottom:5px; }
  .pop-status { font-family:'Share Tech Mono',monospace; font-size:9px; padding:2px 6px; display:inline-block; margin-bottom:7px; border-radius:2px; }
  .pop-body { font-size:11px; line-height:1.55; color:#8aaabb; }
  .pop-source { font-family:'Share Tech Mono',monospace; font-size:8px; color:#3a5a6a; margin-top:6px; border-top:1px solid rgba(255,255,255,0.06); padding-top:5px; }

  .map-legend {
    position:absolute; bottom:14px; right:14px; z-index:1000;
    background: rgba(5,12,22,0.9); border:1px solid var(--border);
    padding:10px 14px; min-width:180px;
    font-family:'Share Tech Mono',monospace;
  }
  .legend-title { font-size:9px; letter-spacing:2px; color:var(--cyan); margin-bottom:8px; text-transform:uppercase; }
  .legend-item { display:flex; align-items:center; gap:8px; margin-bottom:5px; font-size:10px; color:#7a9bb5; }
  .legend-line { width:28px; height:2px; flex-shrink:0; }
  .legend-swatch { width:10px; height:10px; border-radius:50%; flex-shrink:0; }

  @keyframes pulse-red {
    0%{transform:scale(1); opacity:1}
    50%{transform:scale(1.6); opacity:0.4}
    100%{transform:scale(1); opacity:1}
  }
  @keyframes pulse-amber {
    0%{transform:scale(1); opacity:1}
    60%{transform:scale(1.5); opacity:0.5}
    100%{transform:scale(1); opacity:1}
  }
  .pulse-red-outer {
    border-radius:50%; background:rgba(255,34,34,0.25);
    animation: pulse-red 1.4s ease-in-out infinite;
  }
  .pulse-amber-outer {
    border-radius:50%; background:rgba(255,179,0,0.2);
    animation: pulse-amber 2s ease-in-out infinite;
  }

  /* â”€â”€â”€ LIVE INTEL FEED PANEL â”€â”€â”€ */
  .intel-toggle {
    position: absolute; top: 12px; left: 12px; z-index: 1001;
    background: rgba(5,15,25,0.95); border: 1px solid var(--green);
    color: var(--green); font-family: 'Share Tech Mono', monospace;
    font-size: 11px; letter-spacing: 2px; padding: 8px 14px;
    cursor: pointer; text-transform: uppercase;
    transition: all 0.2s;
    display: flex; align-items: center; gap: 8px;
    box-shadow: 0 0 15px rgba(57,255,20,0.15);
  }
  .intel-toggle:hover { background: rgba(57,255,20,0.1); box-shadow: 0 0 25px rgba(57,255,20,0.25); }
  .intel-toggle .pulse-dot {
    width: 7px; height: 7px; border-radius: 50%;
    background: var(--green); box-shadow: 0 0 6px var(--green);
    animation: liveBlink 1.2s ease-in-out infinite;
  }

  .intel-panel {
    position: absolute; top: 0; left: 0; z-index: 1000;
    width: 420px; height: 100%;
    background: rgba(3,10,18,0.97);
    border-right: 1px solid var(--green);
    transform: translateX(-100%);
    transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex; flex-direction: column;
    box-shadow: 5px 0 30px rgba(0,0,0,0.6);
  }
  .intel-panel.open { transform: translateX(0); }

  .intel-header {
    padding: 14px 16px;
    background: rgba(57,255,20,0.04);
    border-bottom: 1px solid rgba(57,255,20,0.2);
    display: flex; align-items: center; justify-content: space-between;
  }
  .intel-header-left { display: flex; align-items: center; gap: 10px; }
  .intel-header-title {
    font-family: 'Oswald', sans-serif; font-size: 16px; font-weight: 700;
    letter-spacing: 3px; color: var(--green); text-transform: uppercase;
    text-shadow: 0 0 12px rgba(57,255,20,0.4);
  }
  .intel-header-sub {
    font-family: 'Share Tech Mono', monospace; font-size: 9px;
    color: #4a7a5a; letter-spacing: 1px; margin-top: 2px;
  }
  .intel-close {
    background: none; border: 1px solid rgba(255,255,255,0.1);
    color: #5a7a6a; font-size: 18px; cursor: pointer;
    width: 30px; height: 30px; display: flex; align-items: center;
    justify-content: center; transition: all 0.2s;
  }
  .intel-close:hover { border-color: var(--red); color: var(--red); }

  .intel-controls {
    padding: 10px 16px;
    border-bottom: 1px solid rgba(57,255,20,0.1);
    display: flex; align-items: center; justify-content: space-between;
    gap: 10px;
  }
  .intel-refresh-btn {
    background: rgba(57,255,20,0.08); border: 1px solid rgba(57,255,20,0.3);
    color: var(--green); font-family: 'Share Tech Mono', monospace;
    font-size: 10px; letter-spacing: 1.5px; padding: 6px 12px;
    cursor: pointer; text-transform: uppercase; transition: all 0.2s;
  }
  .intel-refresh-btn:hover { background: rgba(57,255,20,0.15); }
  .intel-refresh-btn:disabled { opacity: 0.4; cursor: not-allowed; }
  .intel-refresh-btn.loading {
    animation: loadPulse 1s ease-in-out infinite;
  }
  @keyframes loadPulse { 0%,100%{opacity:0.4} 50%{opacity:1} }

  .intel-status {
    font-family: 'Share Tech Mono', monospace;
    font-size: 9px; color: #3a5a4a; letter-spacing: 1px;
  }
  .intel-auto-label {
    font-family: 'Share Tech Mono', monospace;
    font-size: 9px; color: #4a6a5a; letter-spacing: 1px;
    display: flex; align-items: center; gap: 6px;
  }
  .intel-auto-label input { accent-color: var(--green); }

  .intel-feed {
    flex: 1; overflow-y: auto; padding: 0;
  }
  .intel-feed::-webkit-scrollbar { width: 4px; }
  .intel-feed::-webkit-scrollbar-track { background: transparent; }
  .intel-feed::-webkit-scrollbar-thumb { background: rgba(57,255,20,0.2); border-radius: 2px; }

  .intel-item {
    padding: 12px 16px;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    transition: background 0.15s;
    animation: intelFadeIn 0.4s ease-out;
  }
  @keyframes intelFadeIn { from{opacity:0; transform:translateY(-8px)} to{opacity:1; transform:translateY(0)} }
  .intel-item:hover { background: rgba(57,255,20,0.03); }
  .intel-item-header {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 6px;
  }
  .intel-item-source {
    font-family: 'Share Tech Mono', monospace; font-size: 9px;
    color: var(--cyan); letter-spacing: 1.5px; text-transform: uppercase;
  }
  .intel-item-time {
    font-family: 'Share Tech Mono', monospace; font-size: 9px;
    color: #3a5a4a; letter-spacing: 1px;
  }
  .intel-item-headline {
    font-family: 'Barlow Condensed', sans-serif; font-size: 14px;
    font-weight: 600; color: #ddeeff; line-height: 1.3; margin-bottom: 5px;
  }
  .intel-item-body {
    font-size: 12px; line-height: 1.5; color: #7a9aaa;
  }
  .intel-item-url {
    display: block; margin-top: 6px;
    font-family: 'Share Tech Mono', monospace; font-size: 9px;
    color: var(--green); opacity: 0.6; text-decoration: none;
    overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
    letter-spacing: 0.5px;
  }
  .intel-item-url:hover { opacity: 1; text-decoration: underline; }

  .intel-item.breaking {
    border-left: 3px solid var(--red);
    background: rgba(255,34,34,0.04);
  }
  .intel-item.breaking .intel-item-source { color: var(--red); }

  .intel-empty {
    display: flex; flex-direction: column; align-items: center;
    justify-content: center; height: 100%; gap: 14px;
    color: #3a5a4a;
  }
  .intel-empty-icon { font-size: 32px; opacity: 0.4; }
  .intel-empty-text {
    font-family: 'Share Tech Mono', monospace; font-size: 11px;
    letter-spacing: 1.5px; text-transform: uppercase; text-align: center;
  }

  .intel-error {
    padding: 16px; text-align: center;
    font-family: 'Share Tech Mono', monospace; font-size: 11px;
    color: var(--amber); letter-spacing: 1px;
  }

  /* â”€â”€â”€ MOBILE â”€â”€â”€ */
  @media (max-width: 900px) {
    body {
      grid-template-columns: 1fr;
      grid-template-rows: 50px 1fr 38px;
    }
    aside { display: none; }
    #map { grid-column: 1; }
    footer { grid-column: 1; }
    .header-right .stat-box { display: none; }
    .header-right .vdiv { display: none; }
    .header-sub { display: none; }
    .header-title { font-size: 16px; letter-spacing: 2px; }
    .footer-sources { display: none; }
    .footer-scroll { text-align: left; }
    .intel-panel { width: 100%; }
    .map-legend { display: none; }
  }
  @media (max-width: 600px) {
    .header-title { font-size: 13px; letter-spacing: 1px; }
    .op-badge { font-size: 8px; padding: 2px 6px; }
  }
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="header-left">
    <div class="op-badge">â— LIVE</div>
    <div>
      <div class="header-title"><span>OPERATION</span> EPIC FURY</div>
      <div class="header-sub">JOINT USâ€“ISRAELI MILITARY CAMPAIGN Â· PENTAGON / IDF Â· FEB 28, 2026 Â· 0230 ET LAUNCH</div>
    </div>
  </div>
  <div class="header-right">
    <div class="stat-box">
      <div class="stat-val red">6</div>
      <div class="stat-lbl">Bases Struck</div>
    </div>
    <div class="vdiv"></div>
    <div class="stat-box">
      <div class="stat-val amber">5</div>
      <div class="stat-lbl">On Alert</div>
    </div>
    <div class="vdiv"></div>
    <div class="stat-box">
      <div class="stat-val cyan">4+</div>
      <div class="stat-lbl">Iranian Sites Hit</div>
    </div>
    <div class="vdiv"></div>
    <div class="stat-box">
      <div class="stat-val" style="color:#fff">2</div>
      <div class="stat-lbl">Carrier Groups</div>
    </div>
    <div class="vdiv"></div>
    <div>
      <span class="live-dot"></span>
      <span class="live-label">ACTIVE CONFLICT</span><br>
      <div style="font-family:'Share Tech Mono',monospace;font-size:9px;color:#3a5a6a;margin-top:2px;text-align:right;" id="clock">--:-- UTC</div>
    </div>
  </div>
</header>

<!-- SIDEBAR -->
<aside>
  <div class="section-head attacked"><div class="dot red"></div> Iranian Retaliatory Strikes (Confirmed)</div>
  <div class="base-list">
    <div class="base-item" onclick="flyTo(25.117,51.316,10)">
      <div class="base-icon">ğŸ”´</div>
      <div><div class="base-name">Al Udeid Air Base</div><div class="base-detail">QATAR Â· Largest US base in Middle East<br>~10,000 personnel Â· B-52 staging</div></div>
      <div class="base-status status-hit">HIT</div>
    </div>
    <div class="base-item" onclick="flyTo(26.208,50.616,11)">
      <div class="base-icon">ğŸ”´</div>
      <div><div class="base-name">US 5th Fleet HQ / NSA Bahrain</div><div class="base-detail">BAHRAIN Â· Juffair District<br>Naval HQ, reduced to &lt;100 personnel</div></div>
      <div class="base-status status-hit">HIT</div>
    </div>
    <div class="base-item" onclick="flyTo(29.450,47.521,10)">
      <div class="base-icon">ğŸ”´</div>
      <div><div class="base-name">Ali Al Salem Air Base</div><div class="base-detail">KUWAIT Â· US Air Force operations<br>IRGC confirmed strike</div></div>
      <div class="base-status status-hit">HIT</div>
    </div>
    <div class="base-item" onclick="flyTo(24.241,54.547,10)">
      <div class="base-icon">ğŸ”´</div>
      <div><div class="base-name">Al Dhafra Air Base</div><div class="base-detail">UAE Â· F-35/F-22 Â· ~3,500 US personnel<br>IRGC drills simulated this target Feb 26</div></div>
      <div class="base-status status-hit">HIT</div>
    </div>
    <div class="base-item" onclick="flyTo(24.063,47.562,9)">
      <div class="base-icon">ğŸ”´</div>
      <div><div class="base-name">Prince Sultan Air Base</div><div class="base-detail">SAUDI ARABIA Â· Explosions in Riyadh<br>US bases confirmed struck by Axios/CBS</div></div>
      <div class="base-status status-hit">HIT</div>
    </div>
    <div class="base-item" onclick="flyTo(31.827,36.787,9)">
      <div class="base-icon">ğŸ”´</div>
      <div><div class="base-name">US Bases â€” Jordan</div><div class="base-detail">JORDAN Â· Muwaffaq Salti / Tower 22<br>Targeted per CBS News US officials</div></div>
      <div class="base-status status-hit">TARGETED</div>
    </div>
  </div>

  <div class="section-head alert"><div class="dot amber"></div> US/Coalition Bases â€” On Alert</div>
  <div class="base-list">
    <div class="base-item" onclick="flyTo(33.806,42.440,9)">
      <div class="base-icon">ğŸŸ¡</div>
      <div><div class="base-name">Al-Asad Air Base</div><div class="base-detail">IRAQ (Anbar) Â· Major US air base<br>Previously struck by Iran in 2020</div></div>
      <div class="base-status status-alert">ALERT</div>
    </div>
    <div class="base-item" onclick="flyTo(36.234,43.956,10)">
      <div class="base-icon">ğŸŸ¡</div>
      <div><div class="base-name">Erbil Base / Coalition HQ</div><div class="base-detail">IRAQ (Kurdistan) Â· Iraq airspace closed<br>IRGC proxy threat elevated</div></div>
      <div class="base-status status-alert">ALERT</div>
    </div>
    <div class="base-item" onclick="flyTo(33.507,38.674,8)">
      <div class="base-icon">ğŸŸ¡</div>
      <div><div class="base-name">Al-Tanf Garrison</div><div class="base-detail">SYRIA Â· ~200 US SOF Â· Tripoint border<br>Iran-aligned militia nearby</div></div>
      <div class="base-status status-alert">ALERT</div>
    </div>
    <div class="base-item" onclick="flyTo(28.873,48.168,9)">
      <div class="base-icon">ğŸŸ¡</div>
      <div><div class="base-name">Camp Arifjan</div><div class="base-detail">KUWAIT Â· US Army logistics hub<br>Explosions reported in Kuwait</div></div>
      <div class="base-status status-alert">ALERT</div>
    </div>
  </div>

  <div class="section-head offense"><div class="dot blue"></div> Israeli Offensive Bases (IDF / Lion's Roar)</div>
  <div class="base-list">
    <div class="base-item" onclick="flyTo(31.210,35.054,10)">
      <div class="base-icon">âœˆï¸</div>
      <div><div class="base-name">Nevatim Air Base</div><div class="base-detail">ISRAEL (Negev) Â· F-35I "Adir" primary base<br>Main launch point for Iran strikes</div></div>
      <div class="base-status status-active">ACTIVE</div>
    </div>
    <div class="base-item" onclick="flyTo(29.725,35.006,10)">
      <div class="base-icon">âœˆï¸</div>
      <div><div class="base-name">Ramon Air Base</div><div class="base-detail">ISRAEL (Negev) Â· IDF+USAF F-35s<br>US Embassy shelter-in-place issued</div></div>
      <div class="base-status status-active">ACTIVE</div>
    </div>
  </div>

  <div class="section-head naval"><div class="dot cyan"></div> US Naval Strike Groups</div>
  <div class="base-list">
    <div class="base-item" onclick="flyTo(32.5,34.2,8)">
      <div class="base-icon">âš“</div>
      <div><div class="base-name">USS Gerald R. Ford CSG</div><div class="base-detail">Off Israeli coast (deployed Feb 27)<br>Tomahawk + air wing strike capability</div></div>
      <div class="base-status status-patrol">DEPLOYED</div>
    </div>
    <div class="base-item" onclick="flyTo(26.5,56.5,7)">
      <div class="base-icon">âš“</div>
      <div><div class="base-name">USS Abraham Lincoln CSG</div><div class="base-detail">Persian Gulf Â· F-35 intercept Feb 3<br>Primary strike group for Iran ops</div></div>
      <div class="base-status status-patrol">DEPLOYED</div>
    </div>
  </div>

  <div class="section-head iran"><div class="dot purple"></div> Iranian Sites Struck (US/Israel)</div>
  <div class="base-list">
    <div class="base-item" onclick="flyTo(35.689,51.389,9)">
      <div class="base-icon">ğŸ’¥</div>
      <div><div class="base-name">Tehran â€” Multiple Districts</div><div class="base-detail">Khamenei residence Â· Ministry of Defense<br>IRGC HQ Â· University St Â· Jomhouri Area</div></div>
      <div class="base-status status-struck">STRUCK</div>
    </div>
    <div class="base-item" onclick="flyTo(33.722,51.728,9)">
      <div class="base-icon">ğŸ’¥</div>
      <div><div class="base-name">Natanz Nuclear Facility</div><div class="base-detail">Main enrichment site Â· Isfahan Province<br>Previously hit June 2025</div></div>
      <div class="base-status status-struck">STRUCK</div>
    </div>
    <div class="base-item" onclick="flyTo(34.883,50.983,9)">
      <div class="base-icon">ğŸ’¥</div>
      <div><div class="base-name">Fordow (FFEP)</div><div class="base-detail">Underground enrichment Â· Near Qom<br>High-value hardened target</div></div>
      <div class="base-status status-struck">STRUCK</div>
    </div>
    <div class="base-item" onclick="flyTo(33.637,46.423,8)">
      <div class="base-icon">ğŸ’¥</div>
      <div><div class="base-name">Ilam Province â€” Western Iran</div><div class="base-detail">IRGC installations Â· IDF confirmed<br>Missile storage / launch sites</div></div>
      <div class="base-status status-struck">STRUCK</div>
    </div>
    <div class="base-item" onclick="flyTo(26.567,56.25,8)">
      <div class="base-icon">âš ï¸</div>
      <div><div class="base-name">Strait of Hormuz</div><div class="base-detail">20% global oil supply Â· Iran closed briefly<br>IRGC seized 2 tankers Feb 5</div></div>
      <div class="base-status" style="background:rgba(255,179,0,0.12);color:var(--amber);border:1px solid rgba(255,179,0,0.25)">CRITICAL</div>
    </div>
  </div>
</aside>

<!-- MAP -->
<div id="map">
  <!-- Intel toggle button (inside map) -->
  <button class="intel-toggle" id="intelToggle" onclick="toggleIntel()">
    <div class="pulse-dot"></div>
    LIVE INTEL FEED
  </button>

  <!-- Intel panel (slides over map) -->
  <div class="intel-panel" id="intelPanel">
    <div class="intel-header">
      <div class="intel-header-left">
        <div class="dot green"></div>
        <div>
          <div class="intel-header-title">LIVE INTEL FEED</div>
          <div class="intel-header-sub">AI-POWERED OSINT Â· AUTO-UPDATING</div>
        </div>
      </div>
      <button class="intel-close" onclick="toggleIntel()">âœ•</button>
    </div>
    <div class="intel-controls">
      <button class="intel-refresh-btn" id="refreshBtn" onclick="fetchIntel()">
        â†» FETCH LATEST
      </button>
      <label class="intel-auto-label">
        <input type="checkbox" id="autoRefresh" checked onchange="toggleAutoRefresh()">
        AUTO (5 MIN)
      </label>
      <div class="intel-status" id="intelStatus">READY</div>
    </div>
    <div class="intel-feed" id="intelFeed">
      <div class="intel-empty">
        <div class="intel-empty-icon">ğŸ“¡</div>
        <div class="intel-empty-text">Click "FETCH LATEST" to pull<br>live intelligence from news sources</div>
      </div>
    </div>
  </div>
</div>

<!-- FOOTER -->
<footer>
  <div class="footer-sources">
    <span>SRC: REUTERS</span><span>Â·</span>
    <span>NBC NEWS</span><span>Â·</span>
    <span>AL JAZEERA</span><span>Â·</span>
    <span>AXIOS</span><span>Â·</span>
    <span>CBS NEWS</span><span>Â·</span>
    <span>PENTAGONÂ·X</span>
  </div>
  <div class="footer-scroll">
    <span class="ticker-wrap" id="tickerWrap">
      â— IRAN INTERNET SHUTDOWN CONFIRMED (NETBLOCKS) &nbsp;Â·&nbsp;
      â— ISRAEL STATE OF EMERGENCY DECLARED â€” DEF MIN KATZ &nbsp;Â·&nbsp;
      â— SECOND IRANIAN MISSILE BARRAGE TOWARD ISRAEL CONFIRMED â€” IDF &nbsp;Â·&nbsp;
      â— 1 KILLED IN ABU DHABI FROM INTERCEPTED MISSILE SHRAPNEL â€” UAE WAM &nbsp;Â·&nbsp;
      â— IRAN FM: "ALL US AND ISRAELI ASSETS IN MIDDLE EAST ARE LEGITIMATE TARGETS â€” NO RED LINES" &nbsp;Â·&nbsp;
      â— QATAR, UAE, KUWAIT, BAHRAIN, IRAQ AIRSPACE CLOSED &nbsp;Â·&nbsp;
      â— USS GERALD R. FORD CSG POSITIONED OFF ISRAELI COAST â€” PENTAGON &nbsp;Â·&nbsp;
      â— TRUMP: "MAJOR COMBAT OPERATIONS" â€” TRUTH SOCIAL 0231 ET &nbsp;Â·&nbsp;
      â— NETANYAHU: "LION'S ROAR â€” OPERATION TO REMOVE EXISTENTIAL THREAT" &nbsp;Â·&nbsp;
    </span>
  </div>
  <div style="font-family:'Share Tech Mono',monospace;font-size:9px;text-align:right;">
    CLASSIFICATION: UNCLASSIFIED // OPEN SOURCE ONLY<br>
    <span style="color:#2a3a4a;">Â© OPEN-SOURCE INTELLIGENCE COMPILATION 2026</span>
  </div>
</footer>

<!-- MAP LEGEND OVERLAY -->
<div class="map-legend" id="map-legend">
  <div class="legend-title">Range Circles</div>
  <div class="legend-item">
    <div class="legend-line" style="background:rgba(213,0,249,0.7);height:2px;border-top:2px dashed rgba(213,0,249,0.7);"></div>
    <span>Iran Ballistic (~2,000km)</span>
  </div>
  <div class="legend-item">
    <div class="legend-line" style="border-top:2px dashed rgba(0,229,255,0.5);height:0;"></div>
    <span>Tomahawk TLAM (~1,600km)</span>
  </div>
  <div class="legend-item">
    <div class="legend-line" style="border-top:2px dashed rgba(41,121,255,0.5);height:0;"></div>
    <span>F-35 Strike Radius (~2,200km)</span>
  </div>
  <div style="margin-top:10px; border-top:1px solid rgba(255,255,255,0.06); padding-top:8px;">
    <div class="legend-title">Markers</div>
    <div class="legend-item"><div class="legend-swatch" style="background:var(--red);box-shadow:0 0 5px var(--red)"></div><span>Base Attacked (Iran)</span></div>
    <div class="legend-item"><div class="legend-swatch" style="background:var(--amber);box-shadow:0 0 5px var(--amber)"></div><span>On Alert</span></div>
    <div class="legend-item"><div class="legend-swatch" style="background:var(--blue);box-shadow:0 0 5px var(--blue)"></div><span>Israeli Offensive Base</span></div>
    <div class="legend-item"><div class="legend-swatch" style="background:var(--cyan);box-shadow:0 0 5px var(--cyan)"></div><span>US Naval Group</span></div>
    <div class="legend-item"><div class="legend-swatch" style="background:var(--purple);box-shadow:0 0 5px var(--purple)"></div><span>Iranian Site Struck</span></div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLOCK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateClock() {
  const now = new Date();
  const h = String(now.getUTCHours()).padStart(2,'0');
  const m = String(now.getUTCMinutes()).padStart(2,'0');
  const s = String(now.getUTCSeconds()).padStart(2,'0');
  document.getElementById('clock').textContent = h+':'+m+':'+s+' UTC';
}
setInterval(updateClock, 1000); updateClock();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAP INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const map = L.map('map', {
  center: [30, 50],
  zoom: 5,
  zoomControl: false,
  attributionControl: false
});

L.control.zoom({ position: 'topright' }).addTo(map);
L.control.attribution({ position: 'bottomleft', prefix: '' }).addTo(map);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: 'Â© OpenStreetMap',
  maxZoom: 12
}).addTo(map);

document.getElementById('map').appendChild(document.getElementById('map-legend'));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAP ICONS & HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function makeIcon(color, size, pulse) {
  const r = size/2;
  const pr = size * 1.8;
  const pulseAnim = pulse ? `
    <circle cx="${pr}" cy="${pr}" r="${r}" fill="${color}" opacity="0.5">
      <animate attributeName="r" from="${r}" to="${pr*0.85}" dur="${pulse}s" repeatCount="indefinite"/>
      <animate attributeName="opacity" from="0.6" to="0" dur="${pulse}s" repeatCount="indefinite"/>
    </circle>` : '';
  const html = `<svg width="${pr*2}" height="${pr*2}" viewBox="0 0 ${pr*2} ${pr*2}" xmlns="http://www.w3.org/2000/svg">
    ${pulseAnim}
    <circle cx="${pr}" cy="${pr}" r="${r+3}" fill="${color}" opacity="0.25"/>
    <circle cx="${pr}" cy="${pr}" r="${r}" fill="${color}"/>
    <circle cx="${pr}" cy="${pr}" r="${r*0.5}" fill="rgba(255,255,255,0.7)"/>
  </svg>`;
  return L.divIcon({ html, iconSize: [pr*2, pr*2], iconAnchor: [pr, pr], className: '' });
}

function makeExplosionIcon(label) {
  const html = `<div style="text-align:center;">
    <div style="font-size:20px;line-height:1;filter:drop-shadow(0 0 6px rgba(255,100,0,0.8));">ğŸ’¥</div>
    <div style="font-family:'Share Tech Mono',monospace;font-size:8px;color:#ff6600;white-space:nowrap;text-shadow:0 0 4px #ff4400;max-width:90px;text-align:center;">${label}</div>
  </div>`;
  return L.divIcon({ html, iconSize:[90,38], iconAnchor:[45,10], className:'' });
}

function makeNavalIcon(label) {
  const html = `<div style="text-align:center;">
    <div style="font-size:18px;line-height:1;filter:drop-shadow(0 0 8px rgba(0,229,255,0.9));">âš“</div>
    <div style="font-family:'Share Tech Mono',monospace;font-size:8px;color:#00e5ff;white-space:nowrap;text-shadow:0 0 4px #00e5ff;">${label}</div>
  </div>`;
  return L.divIcon({ html, iconSize:[120,34], iconAnchor:[60,9], className:'' });
}

const RED='#ff2222', AMBER='#ffb300', BLUE='#2979ff', GREEN='#39ff14', PURPLE='#d500f9', CYAN='#00e5ff';

window.flyTo = function(lat,lng,z){ map.flyTo([lat,lng],z,{duration:1.2}); }

function addBase(lat,lng,icon,title,statusHtml,body,source) {
  const pop = `<div class="pop-title">${title}</div>
    <div class="pop-status ${statusHtml.cls}" style="${statusHtml.style}">${statusHtml.text}</div>
    <div class="pop-body">${body}</div>
    <div class="pop-source">SRC: ${source}</div>`;
  L.marker([lat,lng],{icon}).addTo(map).bindPopup(pop, {maxWidth:260});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAP MARKERS â€” ALL BASES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ATTACKED (red)
addBase(25.117,51.316, makeIcon(RED,9,1.2), 'Al Udeid Air Base â€” Qatar',
  {cls:'pop-status',style:'background:rgba(255,34,34,0.15);color:#ff2222;border:1px solid rgba(255,34,34,0.4)',text:'âš  CONFIRMED HIT'},
  'Largest US base in Middle East. ~10,000 personnel, B-52 bombers. Ballistic missile strikes confirmed by Al Jazeera & Fars News. Qatar CAA suspended airspace.','AL JAZEERA Â· REUTERS Â· FARS NEWS');

addBase(26.208,50.616, makeIcon(RED,9,1.2), 'US 5th Fleet HQ / NSA Bahrain',
  {cls:'pop-status',style:'background:rgba(255,34,34,0.15);color:#ff2222;border:1px solid rgba(255,34,34,0.4)',text:'âš  CONFIRMED HIT'},
  'Juffair district. US Navy 5th Fleet headquarters. Smoke reported near base. Bahrain confirmed missile attack. US Embassy: "imminent drone/missile attack" alert issued.','CNBC Â· AXIOS Â· BAHRAIN GOVT');

addBase(29.450,47.521, makeIcon(RED,9,1.2), 'Ali Al Salem Air Base â€” Kuwait',
  {cls:'pop-status',style:'background:rgba(255,34,34,0.15);color:#ff2222;border:1px solid rgba(255,34,34,0.4)',text:'âš  CONFIRMED HIT'},
  'US Air Force operations base. IRGC confirmed strike via Fars News. Multiple explosions across Kuwait. Airspace closed.','CBS Â· AL JAZEERA Â· IRAN FARS');

addBase(24.241,54.547, makeIcon(RED,9,1.2), 'Al Dhafra Air Base â€” UAE',
  {cls:'pop-status',style:'background:rgba(255,34,34,0.15);color:#ff2222;border:1px solid rgba(255,34,34,0.4)',text:'âš  CONFIRMED HIT'},
  'Hosts F-35, F-22, ~3,500 US personnel. IRGC ran attack-simulation drills against this base on Feb 26. 1 civilian killed in Abu Dhabi by intercepted missile shrapnel.','CBS Â· FARS Â· MIDDLE EAST EYE');

addBase(24.063,47.562, makeIcon(RED,9,1.2), 'Prince Sultan Air Base â€” Saudi Arabia',
  {cls:'pop-status',style:'background:rgba(255,34,34,0.15);color:#ff2222;border:1px solid rgba(255,34,34,0.4)',text:'âš  STRUCK'},
  'Explosions reported in Riyadh. US bases in Saudi Arabia confirmed struck by Iranian missiles per Axios and CBS News. Saudi Arabia officially opposed use of its territory.','AXIOS Â· CBS Â· REUTERS');

addBase(31.827,36.787, makeIcon(RED,8,1.5), 'US Bases â€” Jordan',
  {cls:'pop-status',style:'background:rgba(255,34,34,0.15);color:#ff2222;border:1px solid rgba(255,34,34,0.4)',text:'âš  TARGETED'},
  'US sources told CBS News that bases in Jordan were targeted. Includes Muwaffaq Salti / Tower 22. No confirmed hits at time of publication.','CBS NEWS Â· TASNIM');

// ON ALERT (amber)
addBase(33.806,42.440, makeIcon(AMBER,8,2.5), 'Al-Asad Air Base â€” Iraq',
  {cls:'pop-status',style:'background:rgba(255,179,0,0.12);color:#ffb300;border:1px solid rgba(255,179,0,0.3)',text:'âš¡ ON ALERT'},
  'Major US air base in Anbar province. Targeted by Iranian ballistic missiles in 2020 (TBI injuries). Under elevated force protection. Iraq closed national airspace.','PENTAGON Â· NBC Â· WIKIPEDIA');

addBase(36.234,43.956, makeIcon(AMBER,8,2.5), 'Erbil US Base / Coalition HQ â€” Iraq',
  {cls:'pop-status',style:'background:rgba(255,179,0,0.12);color:#ffb300;border:1px solid rgba(255,179,0,0.3)',text:'âš¡ ON ALERT'},
  'US military presence at Erbil, Kurdistan region. IRGC proxies have struck this location before. Iraq closed airspace. Shelter-in-place for all US personnel.','NBC Â· PENTAGON');

addBase(33.507,38.674, makeIcon(AMBER,8,2.5), 'Al-Tanf Garrison â€” Syria',
  {cls:'pop-status',style:'background:rgba(255,179,0,0.12);color:#ffb300;border:1px solid rgba(255,179,0,0.3)',text:'âš¡ ON ALERT'},
  '~200 US SOF at Syrian-Iraqi-Jordanian tripoint. Iran-aligned militias operate in surrounding area. Elevated threat.','PENTAGON');

addBase(28.873,48.168, makeIcon(AMBER,8,2.5), 'Camp Arifjan â€” Kuwait',
  {cls:'pop-status',style:'background:rgba(255,179,0,0.12);color:#ffb300;border:1px solid rgba(255,179,0,0.3)',text:'âš¡ ON ALERT'},
  'Major US Army logistics hub. Explosions reported across Kuwait. Adjacent to Ali Al Salem strike zone.','CBS Â· AL JAZEERA');

// ISRAELI (blue)
addBase(31.210,35.054, makeIcon(BLUE,8,2), 'Nevatim Air Base â€” Israel (IDF)',
  {cls:'pop-status',style:'background:rgba(41,121,255,0.12);color:#2979ff;border:1px solid rgba(41,121,255,0.3)',text:'âœˆ ACTIVE STRIKES'},
  'Primary F-35I "Adir" base. Main launch point for Israeli strikes on Iran under Operation Lion\'s Roar. Under incoming Iranian missile threat â€” state of emergency declared.','IDF Â· CBS Â· REUTERS');

addBase(29.725,35.006, makeIcon(BLUE,8,2), 'Ramon Air Base â€” Israel (IDF/USAF)',
  {cls:'pop-status',style:'background:rgba(41,121,255,0.12);color:#2979ff;border:1px solid rgba(41,121,255,0.3)',text:'âœˆ ACTIVE STRIKES'},
  'Dual-use IDF/USAF base in Negev. Hosts US F-35 rotational forces. Israel closed all civilian airspace. US Embassy Jerusalem: shelter-in-place for all personnel.','IDF Â· NBC Â· CBS');

// CARRIERS (cyan)
addBase(32.5,34.2, makeNavalIcon('FORD CSG'), 'USS Gerald R. Ford (CVN-78)',
  {cls:'pop-status',style:'background:rgba(0,229,255,0.10);color:#00e5ff;border:1px solid rgba(0,229,255,0.25)',text:'âš“ DEPLOYED'},
  'Aircraft carrier strike group. Deployed off Israeli coast Feb 27. Provides Tomahawk strike capability, air defense umbrella, and F-18 strike aircraft. Part of 2-carrier buildup.','AXIOS Â· NBC Â· PENTAGON');

addBase(26.5,56.5, makeNavalIcon('LINCOLN CSG'), 'USS Abraham Lincoln (CVN-72)',
  {cls:'pop-status',style:'background:rgba(0,229,255,0.10);color:#00e5ff;border:1px solid rgba(0,229,255,0.25)',text:'âš“ DEPLOYED'},
  'Aircraft carrier strike group. Persian Gulf. F-35 shot down Iranian Shahed-139 drone approaching Lincoln on Feb 3. Primary platform for Operation Epic Fury strikes on Iran.','WIKIPEDIA Â· NBC Â· PENTAGON');

// IRANIAN TARGETS (purple)
addBase(35.689,51.389, makeExplosionIcon('TEHRAN'), 'ğŸ’¥ Tehran â€” Iranian Capital',
  {cls:'pop-status',style:'background:rgba(213,0,249,0.12);color:#d500f9;border:1px solid rgba(213,0,249,0.3)',text:'â˜¢ US/ISRAEL STRIKES'},
  'Multiple confirmed strikes: University St, Jomhouri area, Seyyed Khandan (N. Tehran). Khamenei\'s residence reported as target. Iranian internet shut down by government.','REUTERS Â· AP Â· FARS Â· AL JAZEERA');

addBase(33.722,51.728, makeExplosionIcon('NATANZ'), 'ğŸ’¥ Natanz Nuclear Facility',
  {cls:'pop-status',style:'background:rgba(213,0,249,0.12);color:#d500f9;border:1px solid rgba(213,0,249,0.3)',text:'â˜¢ US/ISRAEL STRIKES'},
  'Main uranium enrichment site in Isfahan Province. Previously struck in June 2025 US campaign. Satellite imagery showed accelerated missile site repairs since then.','REUTERS Â· NYT Â· AXIOS');

addBase(34.883,50.983, makeExplosionIcon('FORDOW'), 'ğŸ’¥ Fordow (FFEP) â€” Underground Enrichment',
  {cls:'pop-status',style:'background:rgba(213,0,249,0.12);color:#d500f9;border:1px solid rgba(213,0,249,0.3)',text:'â˜¢ US/ISRAEL STRIKES'},
  'Deeply buried enrichment facility near Qom. Protected by mountain. High-value target for US bunker-buster munitions in nuclear dismantlement campaign.','REUTERS Â· AXIOS');

addBase(33.637,46.423, makeExplosionIcon('ILAM'), 'ğŸ’¥ Ilam Province â€” West Iran IRGC',
  {cls:'pop-status',style:'background:rgba(213,0,249,0.12);color:#d500f9;border:1px solid rgba(213,0,249,0.3)',text:'â˜¢ ISRAEL STRIKES'},
  'IDF confirmed strikes in western Iran including Ilam province. IRGC missile storage and launch infrastructure targeted.','IDF Â· AL JAZEERA');

// STRAIT OF HORMUZ
L.marker([26.567,56.25], {
  icon: L.divIcon({
    html: `<div style="text-align:center;animation:pulse-amber-outer 2s ease-in-out infinite;">
      <div style="font-size:16px;line-height:1;filter:drop-shadow(0 0 8px rgba(255,179,0,0.9));">âš ï¸</div>
      <div style="font-family:'Share Tech Mono',monospace;font-size:8px;color:#ffb300;white-space:nowrap;text-shadow:0 0 4px #ffb300;">STRAIT OF HORMUZ</div>
    </div>`,
    iconSize:[120,32], iconAnchor:[60,8], className:''
  })
}).addTo(map).bindPopup(`
  <div class="pop-title">âš  Strait of Hormuz â€” Strategic Chokepoint</div>
  <div class="pop-status" style="background:rgba(255,179,0,0.12);color:#ffb300;border:1px solid rgba(255,179,0,0.25)">CRITICAL RISK</div>
  <div class="pop-body">~20% of global oil transits through here daily. Iran briefly closed Strait during Feb 17 military drills. IRGC seized 2 tankers near Farsi Island on Feb 5. If closed: severe global energy shock. Oil prices already at 6-month highs.</div>
  <div class="pop-source">CNBC Â· REUTERS Â· WIKIPEDIA</div>
`, {maxWidth:260});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RANGE CIRCLES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
L.circle([35.689, 51.389], { radius:2000000, color:PURPLE, weight:1.5, fillColor:PURPLE, fillOpacity:0.04, dashArray:'8,6'
}).addTo(map).bindTooltip('Iran Ballistic Missile Range ~2,000km', { sticky:true, direction:'top' });

L.circle([26.5, 56.5], { radius:1600000, color:CYAN, weight:1, fillColor:CYAN, fillOpacity:0.025, dashArray:'6,5'
}).addTo(map).bindTooltip('USS Lincoln â€” Tomahawk TLAM Range ~1,600km', { sticky:true, direction:'top' });

L.circle([31.210, 35.054], { radius:2200000, color:BLUE, weight:1, fillColor:BLUE, fillOpacity:0.025, dashArray:'5,5'
}).addTo(map).bindTooltip('Israeli F-35I Strike Radius ~2,200km (w/ refueling)', { sticky:true, direction:'top' });

L.circle([30.5, 49.5], { radius:900000, color:RED, weight:1, fillColor:RED, fillOpacity:0.04, dashArray:'4,4'
}).addTo(map).bindTooltip('IRGC Short-Range / Ballistic Threat Zone ~900km', { sticky:true, direction:'top' });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LIVE INTEL FEED â€” Anthropic API + Web Search
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let autoRefreshInterval = null;
let intelItems = [];

function toggleIntel() {
  const panel = document.getElementById('intelPanel');
  panel.classList.toggle('open');
}

function toggleAutoRefresh() {
  const checked = document.getElementById('autoRefresh').checked;
  if (checked) {
    startAutoRefresh();
  } else {
    stopAutoRefresh();
  }
}

function startAutoRefresh() {
  stopAutoRefresh();
  autoRefreshInterval = setInterval(() => {
    fetchIntel();
  }, 5 * 60 * 1000); // 5 minutes
}

function stopAutoRefresh() {
  if (autoRefreshInterval) {
    clearInterval(autoRefreshInterval);
    autoRefreshInterval = null;
  }
}

// Start auto-refresh on load
startAutoRefresh();

async function fetchIntel() {
  const btn = document.getElementById('refreshBtn');
  const status = document.getElementById('intelStatus');

  btn.disabled = true;
  btn.classList.add('loading');
  btn.textContent = 'âŸ³ SEARCHING...';
  status.textContent = 'QUERYING SOURCES...';
  status.style.color = 'var(--amber)';

  try {
    // Use Anthropic API with web search to find latest news
    const searchQueries = [
      'Iran US military strikes latest today 2026',
      'Operation Epic Fury Iran Israel news today',
      'Middle East conflict Iran nuclear February 2026'
    ];

    // Make parallel search calls via Anthropic API
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        tools: [{ type: 'web_search_20250305', name: 'web_search' }],
        messages: [{
          role: 'user',
          content: `You are a military OSINT news aggregator. Search for the very latest news about the Iran-US-Israel military conflict, Operation Epic Fury, Iranian nuclear strikes, Middle East military developments, and any related breaking news from today February 28, 2026.

Return ONLY a valid JSON array (no markdown, no backticks, no preamble) of news items. Each item should have these fields:
- "headline": string (short, punchy headline)
- "body": string (2-3 sentence summary)
- "source": string (news outlet name, uppercase)
- "url": string (source URL if available, empty string if not)
- "breaking": boolean (true if this is a major breaking development)
- "time": string (time of report if known, e.g. "14:30 UTC" or "2 hours ago")

Return 6-10 items sorted by recency (newest first). Focus on factual reporting from Reuters, AP, BBC, Al Jazeera, NBC, CBS, CNN, Axios, NYT, and other major outlets.`
        }]
      })
    });

    if (!response.ok) {
      throw new Error(`API returned ${response.status}`);
    }

    const data = await response.json();

    // Extract text from response
    let fullText = '';
    if (data.content) {
      for (const block of data.content) {
        if (block.type === 'text') {
          fullText += block.text;
        }
      }
    }

    // Parse JSON from response
    let newsItems = [];
    try {
      // Try to find JSON array in response
      const jsonMatch = fullText.match(/\[[\s\S]*\]/);
      if (jsonMatch) {
        newsItems = JSON.parse(jsonMatch[0]);
      }
    } catch (parseErr) {
      console.warn('JSON parse failed, using raw text', parseErr);
    }

    if (newsItems.length > 0) {
      renderIntelItems(newsItems);
      updateTicker(newsItems);
      status.textContent = `UPDATED ${new Date().toUTCString().slice(17,25)} UTC`;
      status.style.color = 'var(--green)';
    } else {
      // If structured parsing failed, show the raw intel
      renderRawIntel(fullText);
      status.textContent = `PARTIAL ${new Date().toUTCString().slice(17,25)} UTC`;
      status.style.color = 'var(--amber)';
    }

  } catch (err) {
    console.error('Intel fetch error:', err);
    document.getElementById('intelFeed').innerHTML = `
      <div class="intel-error">
        âš  SIGNAL INTERRUPTED<br><br>
        <span style="color:#5a7a6a;font-size:10px;">
          ${err.message}<br><br>
          This feed uses the Anthropic API with web search.<br>
          It works automatically when viewed as a<br>
          shared Claude artifact.<br><br>
          For standalone deployment, see the<br>
          deployment guide below.
        </span>
      </div>`;
    status.textContent = 'ERROR';
    status.style.color = 'var(--red)';
  }

  btn.disabled = false;
  btn.classList.remove('loading');
  btn.textContent = 'â†» FETCH LATEST';
}

function renderIntelItems(items) {
  const feed = document.getElementById('intelFeed');
  intelItems = items;

  feed.innerHTML = items.map((item, i) => `
    <div class="intel-item ${item.breaking ? 'breaking' : ''}" style="animation-delay:${i * 0.06}s">
      <div class="intel-item-header">
        <div class="intel-item-source">${item.breaking ? 'ğŸ”´ BREAKING Â· ' : ''}${escapeHtml(item.source || 'OSINT')}</div>
        <div class="intel-item-time">${escapeHtml(item.time || 'RECENT')}</div>
      </div>
      <div class="intel-item-headline">${escapeHtml(item.headline)}</div>
      <div class="intel-item-body">${escapeHtml(item.body)}</div>
      ${item.url ? `<a class="intel-item-url" href="${escapeHtml(item.url)}" target="_blank" rel="noopener">${escapeHtml(item.url)}</a>` : ''}
    </div>
  `).join('');
}

function renderRawIntel(text) {
  const feed = document.getElementById('intelFeed');
  // Split into paragraphs and render
  const paragraphs = text.split('\n').filter(p => p.trim());
  feed.innerHTML = paragraphs.map((p, i) => `
    <div class="intel-item" style="animation-delay:${i * 0.06}s">
      <div class="intel-item-header">
        <div class="intel-item-source">AI ANALYSIS</div>
        <div class="intel-item-time">${new Date().toUTCString().slice(17,25)} UTC</div>
      </div>
      <div class="intel-item-body">${escapeHtml(p)}</div>
    </div>
  `).join('');
}

function updateTicker(items) {
  const ticker = document.getElementById('tickerWrap');
  const breakingItems = items.filter(i => i.breaking || i.headline);
  if (breakingItems.length > 0) {
    const tickerText = breakingItems.map(i =>
      `â— ${(i.headline || '').toUpperCase()} â€” ${(i.source || 'OSINT').toUpperCase()}`
    ).join(' &nbsp;Â·&nbsp; ');
    ticker.innerHTML = tickerText + ' &nbsp;Â·&nbsp; ';
  }
}

function escapeHtml(str) {
  if (!str) return '';
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}
</script>
</body>
</html>
